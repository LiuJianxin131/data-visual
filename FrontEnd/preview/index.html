<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src='./echarts.common.min.js'></script>
  <title>预览</title>
</head>
<style>
  body {
    margin: 0;
    padding: 0;
  }

  #root {
    position: fixed;
    background: #0c2a42;
  }

  .row {
    display: flex;
    position: relative;
    flex-direction: row;
  }

  .column {
    display: flex;
    position: relative;
    flex-direction: column;
  }
</style>

<body>
  <div id='root'></div>
</body>
<script>
  var root = document.getElementById('root');
  function init(charts, tree, canvasSize) {
    console.log(tree);
    // init canvas size
    root.style.width = canvasSize.width + 'px';
    root.style.height = canvasSize.height + 'px';

    if (tree.root === null || tree.root.firstChild === null || tree.root.secondChild === null) {
      // init FreeCharts
      setFreeCharts(charts);
    } else {
      // init responsive
      setResponsiveCharts(charts, tree);
    }
  }

  function setResponsiveCharts(charts, tree) {
    root.innerHTML = traversePost(tree.root);
    charts.forEach((chart) => {
      var id = chart.id;
      var div = document.getElementById(id);
      var myChart = echarts.init(div);
      myChart.setOption(chart.option);
    });
  }

  function layoutTemplate(data, firstChild, secondChild) {
    return `<div id="${data.id}" style="width:${data.width};height:${data.height};"class="${data.type}">
                ${firstChild}${secondChild}
            </div>`;
  }

  function traversePost(node) {
    if (!node) return '';
    var firstChild = '', secondChild = '';

    firstChild = traversePost(node.firstChild);
    secondChild = traversePost(node.secondChild);

    return layoutTemplate(node.data, firstChild, secondChild);
  }

  function setFreeCharts(charts) {
    charts.forEach((chart) => {
      var div = document.createElement('div');

      div.style.position = 'absolute';
      div.style.left = chart.position.left + 'px';
      div.style.top = chart.position.top + 'px';
      div.style.width = chart.size.width + 'px';
      div.style.height = chart.size.height + 'px';

      var myChart = echarts.init(div);
      myChart.setOption(chart.option);

      root.appendChild(div);
    });
  }
</script>

</html>